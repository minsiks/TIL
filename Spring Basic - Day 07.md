# 22/5/15 Spring Basic Day07

## Inflearn 스프링 기본 재수강

> 김영한
>
> 강의 목차
>
> 1. 객체 지향 설계와 스프링
> 2. 스프링 핵심 원리 이해1 - 예제 만들기
> 3. 스프링 핵심 원리 이해2 - 객체 지향 원리 적용
> 4. 스프링 컨테이너와 스프링 빈
> 5. 싱글톤 컨테이너
> 6. 컴포넌트 스캔
> 7. 의존관계 자동 주입
> 8. 빈 생명주기 콜백
> 9. 빈 스코프

## 예제 만들기

### 관심사 분리

- 구체적 구현 객체를 의존 하지 않도록 만든다.
- 그래서 AppConfig 등장
- 생성자 주입

## 전체흐름 정리

- 할인 정책을 변경하고자하니 클라이언트 코드인 주문 서비스 구현체도 함께 변경
- DIP 위반, OCP 위반
- 관심사의 분리
- 공연기획자인 AppConfig가 등장

## IoC, DI, 컨테이너

### 제어의 역전 IoC(Inversion of Control)

- 프로그램의 제어 흐름을 직접 제어하는 것이 아니라 외부에서 관리 하는 것을 제어의 역전

> 프레임워크 vs 라이브러리

- 프레임워크가 내가 작성한 코드를 제어하고, 대신 실행하면 프레임워크, 반면 내가 작성한 코드가 직접 제어의 흐름을 담당한다면 그것은 라이브러

### 의존관계 주입 DI(Dependency Injection)

- 의존관계는 정적인 클래스 의존 관계와, 실행 시점에 결정되는 동적인 객체(인스턴스) 의존 관계 둘을 분리해서 사용

### IoC 컨테이너, DI 컨테이너

- AppConfig 처럼 객체를 생성하고 관리하면서 의존관계를 연결해 주는 것을 IoC컨테이너 또는 DI 컨테이너라 한다.

## 스프링으로 전환

- ApplicationContext 를 스프링 컨테이너라 한다.

## 스프링 컨테이너 생성

- BeanFactory
  - 스프링 컨테이너의 최상위 인터페이스
  - getBean()을 제공
  - 대부분의 기능은 BeanFactory가 제공하는 기능
- ApplicationContext
  - BeanFactory 기능을 모두 상속받아서 제공
  - 애플리케이션을 개발 할 때는 빈은 관리하고 조회하는 기능은 물론, 수많은 부가기능 필요
  - 메시지소스를 활용한 국제화 기능
  - 환경변수
  - 애플리케이션 이벤트
  - 편리한 리소스 조회
  - BeanFactory를 직접 사용할 일은 거의 없고 ApplicationContext를 사용
  - BeanFactory나 ApplicationContext를 스프링 컨테이너라 한다.

### 다양한 설정 형식 지원 - 자바 코드, XML

### 스프링 빈 설정 메타 정보 - BeanDefinition

- `BeanDefinition` 이라는 추상화
- 빈설정 메타정보라 한다. `@Bean`  `<bean>`

## 싱글톤 컨테이너

### 싱글톤 패턴

- 클래스의 인스턴스가 딱 1개만 생성되는 것을 보장
- 장점 : 비용 절감 , 효율성 증대
- 문제점
  - 코드 자체가 많이 들어감
  - DIP 위반

### 싱글톤 컨테이너

- 스프링 컨테이너는 싱글톤 패턴의 문제점을 해결하면서, 객체 인스턴스를 싱글톤(1개만 생성)으로 관리

### 싱글톤 방식의 주의점

- 싱글톤 패턴이든, 스프링 같은 싱글톤 컨테이너를 사용하든, 객체 인스턴스를 하나만 생성해서 공유하는 싱글톤 방식은 여러 클라이언트가 하나의 같은 인스턴스를 공유하기 때문에 싱글톤 객체는 상태를 유지(stateful) 하게 설계하면 안된다.
- 무상태(stateless)로 설계해야 한다.

### @Configuration과 싱글톤

- @Configuration이 붙으면 AppConfig 클래스를 상속받은 임의의 다른 클래스를 만듦
- @Bean이 붙은 메서드마다 이미 스프링 빈이 존재하면 존재하는 빈을 반환, 없으면 생성해서 빈으로 등록

## 컴포넌트 스캔

### 컴포넌트 스캔과 의존관계 자동 주입 시작

- 자동으로 스프링 빈을 등록 - 컴포넌트 스캔
- 의존관계 자동으로 주입하는 `@Autowired` 라는 기능도 제공

- @ComponentScan은 @Component 가 붙은 모든 클래스를 스프링 빈으로 등록
- 스프링 빈의 기본 이름은 클래스명을 사용하되 맨 앞글자만 소문자로 사용

### 탐색 위치와 기본 스캔 대상

- 탐색 시작할 위치를 선정 가능
  - basePackages
  - basePackageClasses 
- 지정하지 않으면 @ComponentScan 이 붙은 설정 정보 클래스의 패키지가 시작 위치가 된다
- 권장하는 방법
  - 프로젝트 최상단에 설정 정보 클래스를 위치
- 컴포넌트 스캔 기본 대상
  - @Component 
  - @Controller
  - @Service
  - @Repository
  - @Configuration

### 필터

- `inculeFilters`
- `excludeFilters`

- FilterType 옵션
  - ANNOTATION : 기본값
  - ASSIGNABLE_TYPE : 타입을 인식
  - ASPECTJ : AspectJ 패턴 사용
  - REGEX : 정규 표현식
  - CUSTOM : 인터페이스를 구현 처리

### 중복 등록과 충돌

1. 자동 빈 등록 VS 자동 빈 등록
   1. 이름이 같은 경우 스프링 오류 발생
2. 수동 빈 등록 VS 자동 빈 등록
   1. 수동 빈 등록이 우선

