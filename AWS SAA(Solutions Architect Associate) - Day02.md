# 24/7/10 AWS SAA(Solutions Architect Associate) - Day02

## EC2, 고가용성 및 확장성

### 1. EC2

- 가장 인기있는 서비스
- Elastic Compute Cloud
- 서비스형 인프라스트럭처
- 여러가지 가용성
  - 가상 머신 
  - 가상드라이버, EBS 볼륨 저장
  - 일래스틱 로드 밸런싱
  - 오토스케일링 그룹

- SIZING & configuration options
  - OS
  - CPU
  - RAM
  - 용량
    - Network-attached (EBS,EFS)
    - hardware (EC2 Instance Store)
  - 네트워크 종류 (공용 ip, 속도)
  - 방화벽 규칙(보안 글부)
  - 부트스트랩 스크립트
- EC2 사용자 데이터
  - 사용자 데이터 스크립트를 이용해 인스턴스를 부트스트래핑 가능
  - 부트스트래핑 - 머신이 작동될때 한번 만 실행 
  - 부팅작업을 자동화
    - 업데이트, 설치 , 다운로드 등등
  - 사용자 데이터 스크립트는 루트 계정에서 실행
    - sudo 명령문 사용

- EC2 유형

> 네이밍 협약
>
> ex_ m5.2xlarge
>
> - m : 인스턴스 클래스
> - 5 : 인스턴스 세대
> - 2xlarge : 인스턴스 클래스의 사이즈

- 범용 인스턴스
  - 웹서버, 코드 저장소
  - 다양한 작업
  - 컴퓨트, 메모리, 네트워킹 밸런스가 좋음
- 컴퓨팅 최적화 인스턴스
  - 컴퓨터 집약적 작업에 최적화
    - 일부 데이터 일괄 처리
    - 미디어 트랜스코딩 작업
    - 고성능 웹 서버
    - HPC
    - 머신러닝
    - 전용 게이밍 서버
  - C이름 가지고있음

- 메모리 최적화 인스턴스
  - 대규모 데이터셋을 메모리에서 처리
    - 고성능 관계형 또는 비관계형의 데이터베이스
    - 캐시 저장소
    - 비즈니스 인텔리전스 BI
    - 비정형 데이터의 실시간 처리를 실행
  - R로 시작 X1,Z1 예외로 존재
- 스토리지 최적화 인스턴스
  - 대규모의 데이터셋 엑세스할대 적합
    - 고주파 온라인 트랜잭션 처리 (OLTP)
    - 관계형 & NoSQL databases
    - Cache for in-memory databases (for example, Redis)
    - 데이터 웨어하우징 애플리케이션
    - 분산 파일 시스템

### 2. 보안그룹

- 방화벽 설정
- 네트워크 보안을 실행
- 트래픽 제어
- 허용규칙 설정
- ip 주소 참조 가능
- EC2 인스턴스의 방화벽
  - 포트로 접근
  - IPv4 인지 IPv6인지 확인
  - 인바운드, 아웃바운드 네트워크 통제
- 인스턴스에 여러가지 보안그룹을 먹일수 있다
- 지역과 /VPC 로 제한
- 보안그룹은 EC2 외부에 존재
- SSH액세스를 위해 하나의 별도 보안 그룹을 유지 선호
- 타임 아웃이라면 보안문제
- 연결 거부가 되었다는 응답은 보안그룹은 통과, 애플리케이션 문제
- 기본적으로 모든 인바운드 트래픽은 차단, 모든 아웃바운드 트래픽은 허용
- 프로토콜
  - 22 = SSH (Secure Shell) - 리눅스 연결
  - 21 = FTP (File Transfer Protocol) - 파일 공유 시스템 파일 업로드
  - 22 = SFTP (Secure File Transfer Protocol) - upload file using SSH
  - 80 = HTTP
  - 443 = HTTPS
  - 3389 = RDP (Remote Desktop Protocol) - 윈도우 인스턴스 로그인

### SSH

- Linux, mac, windows>=10 에서 사용
- windows putty사용
- 웹브러우저로 EC2 인스턴스에 연결 (모든 os사용가능)

### Instance 구매 옵션

- On_Demand Instances - 초단위 지불
- Reservced (1 & 3 years)
  - 예약 인스턴스
  - 전환형 예약 인스턴스
- 절약 플랜 (1 & 3 Years) - 달러단위로 특정 사용량을 약정 
- 스폿 인스턴스 - 아주 짧은 워크로드, 싸다 , 신뢰성 낮음
- 전용 호스트 - 물리적 서버 전체를 예약, 인스턴스 배치를 제어
- 전용 인스턴스 - 다른 고객이 하드웨어를 공유 x
- 용량 예약 - 특정한 AZ에 용량을 예약 가능

#### EC2 On Demand

- 사용한대로 지불
  - Linux or Windows - 1분 이후에 초단위로 청구
  - 모든 os - 시간 당 청구
- 비용이 가장 많이 들지만 바로 지불할 금액 x
- 장기적인 약정 x
- 단기적이고 중단 없는 워크로드가 필요할 때, 또는 애필리케이션의 거동을 예측 x

#### EC2 Reserved Instances

- 온디맨드에 비해 72%할인
- 특정한 속성 예약 가능 (Instance Type, Region, Tenancy, OS)
- 예약 기간 - 1년 또는 3년 (3년 할인 더 받음)
- 전부 선결제, 부분선결제 또는 선결제 없음 중 선택
- 예약 범위 - 리전 또는 존
- 사용량이 일정한 애플리케이션에 예약인스턴스를 사용
- ex_ 데이터베이스
- 마켓플레이스에서 살수도 팔수도 있다
- 전환형 예약 인스턴스
  - 인스턴스 타입, 패밀리, 운영체계, 범위, 테넌시를 변경 가능
  - 유연성이 적기에 66%할인

#### EC2 Savings Plans

- 장기간 사용하면 할인 (최대 72%)
- 1년 내지 3년동안 시간당 10$ 약정
- 사용량이ㅣ 한도를 넘어서면 온디맨드 가격 요구
- 특정한 인스턴스와 패밀리, 리전으로 고정
- 유연한 것들
  - Instance Size
  - OS
  - Tenancy

#### EC2 Spot Instances

- 할인폭이 제일 큼 (최대 90%)
- 최대 가격을 넘어서면 인스턴스가 손실
- 비용효율적인 인스턴스
- 인스턴스가 고장에 대한 회복력이 있다면 유용
  - 배치 작업, 데이터분석, 이미지 처리, 모든 종류의 분산형 워크로드 등

- 중요한 작업이나 데이터베이스에는 적절 x 

#### EC2 Dedicated Hosts(전용 호스트)

- ec2 인스턴스는 실제 물리적 서버를 받게 됨
- 법규 준수 요건이 있는 활용 사례나 소켓, 코어, VM 소프트웨어 라이선스를 기준으로 청구되는 기존의 서버에 연결된 소프트웨어 라이센스가 있는 경우
- 구매 옵션
  - 온디맨드 - 초당 비용 지불
  - 예약 - 1년 3년
- 물리적 서버를 예약하기 때문에 AWS에서 가장 비싼 옵션
- 활용 사례 - 라이선싱 모델과 함께 제공되는 소프트웨어, 규정이나 법규를 반드시 준수해야 하는 회사를 갖고있는 경우

#### EC2 Dedicated Instances (전용 인스턴스)

- 전용 하드웨어에서 실행되는 인스턴스
- 물리적 서버와 다름
- 같은 계정에서 다른 인스턴스아 함께 하드웨어를 공유 가능
- 인스턴스 배치에 통제권 x

#### EC2 Capacity Reservations(용량 예약)

- 원하는 기간 동안 특정한 AZ에서 온디맨드 인스턴스를 예약
- 필요할 때마다 용량에접근
- 언제라도 용량을 예약 취소 가능
- 청구할인 없음
- 지역별 예약 인스턴스와 결합하거나 절약 플랜과 결합한다면 청구할인 가능
- 인스턴스를 실행하는지에 무관하게 온디맨드 요금이 부과

- 특정한 AZ에 있어야 하는 단기적이고 중단 없는 워크로드에 아주 적합

### 3. EC2 Spot Instance

- 온디맨드에 비해 90%최대 할인
- 인스펀스의 스팟 가격이 우리가 지불하고자하는 최대 가격보다 낮다면 해당 인스턴스를 유지
  - 현재 스팟 가격이 > 맥스 스팟 초과시 
    - 2분의 유예기간
    - 중지
    - 종료
- 스팟 블록 : AWS가 스팟 인스턴스를 회수하는 것을 원하지 안승ㄹ때
  - 지정된 기간동안 스팟 인스턴스를 차단
  - 1~6시간까지
- 배치 작업, 데이터 분석, 복원력이 뛰어난 워크로드 등에 사용
- 중요한 작업이나 데이터베이스 X
- 스팟 Instance 종료
  - 스팟 인스턴스 요청
    - 인스턴스 수, 최대 가격 및 시작 사양 등을 정의
    - 일회서 요청 - 스팟 요청이 완료되는 즉시 인스턴스가 시작 후 요청 사라짐
    - 영구 인스턴스 요청 - 스팟 요청이 유효한 기간 동안은 이 인스턴스 수도 유효, 중지되거나 스팟가격을 기준으로 중단되도 스팟 요청이 다시실행, 유효성이 확인되면 다시
  - 스팟요청을 취소하려면 스팟 요청이 활성, 비활성화 상태여야함
  - 순서
    - 스팟 요청 취소 - 스팟 인스턴스를 종료

- 스팟 플릿(Spot Fleets)
  - 스팟 인스턴스 세트를 정의 + (옵션) 온디맨드 인스턴스
  - 정의한 가격 제한으로 목표 용량을 충족
    - 다양한 인스턴스 유형 다양한 os 및 다양한 가용성 영역
    - 다양한 런치 풀 중 가장 적합한 런치풀을 선택
    - 용량 또는 비용 최대치일때 스팟 플릿은 중지
  - 스팟인스턴스를 할당하는 전략
    - 최저 가격 : 가장 낮은 가격인 풀에서 인스턴스를 시작 ,비용 최적화 (워크로드가 매우 짧은 경우 좋은 옵션)
    - 다각화(diversified) : 정의한 모든풀에 분산 (가용성과 긴 워크로드에 적합), 한풀이 사라져도 다른 풀은 여전히 활성화
    - 용량 최적화 : 원하는 인스턴스 수에 맞는 최적의 용량을 가진 풀 가짐 
      - 가격 용량 최적화 : 먼저 사용 가능한 용량이 가장 큰 풀을 선택, 그중 가장 낮은 풀을 선택 (대부분의 워크로드에 가장 적합)
  - 사용시 여러개의 런치 풀과 여러 인스턴스의 유형을 정의 가능

### 4. EC2 SSA수준

#### 공용 IP vs 사설 IP (IPv4)

- IPv4 : 네개의 숫자가 세개의 점으로 분리된 형태 (1.160.10.240)
- IPv6 : 길고 독특한 숫자 기호와 문자로 이뤄진 이상한 문자열 형태(1900:4545:3:200:f8ff:fe21:67cf)

- IPv4는 공용 공간에서 37억 개의 서로 다른 주소를 허용
  - 거의 고갈
- 공용 IP
  - 기기가 인터넷상에서 식별 가능
  - 전체 웹에서 유일한 값이여야 함 (두 개 이상의 기기가 같은 공용 IP 가질 수 X)
  - 지리적 위치 찾을 수 잇음
- Private 사설 ip
  - 오직 사설 네트워크 안에서만 식별
  - IP가 사설 네트워크 안에서만 유일
  - 두개의 사설 네트워크 즉 두 개의 다른 회사는 같은 사설 ip를 가질수 있음
  - 지정된 범위의 ip만 사설ip로 사용 가능
- Elastic(탄력적) IPs
  - EC2 인스턴스를 시작하고 중지할 때 공용 ip를 바꾸기 가능
  - 고정된 공용 IP를 사용하면 탄력적 IP가 필요
  - 탄력적 IP는 공용IPv4
  - 삭제전까진 유지
  - 한 번에 한 인스턴스에서만 첨부 가능
  - ip주소가 탄력적이면 한 인스턴스에서 다른 인스턴스로 빠르게 이동
    - 오류를 마스킹 할 때 사용가능 (드문경우)
  - 계정당 탄력적 ip 5개 사용 가능
  - 사용 안하는것이 좋음
- ssh -i "EC2 Tutorial.pem" ec2-user@23.22.160.158

#### EC2 배치 그룹 (Placement Groups)

- EC2 인스턴스가 AWS 인프라에 배치되는 방식을 제어
- 배치 그룹을 사용하는 전략
  - 클러스터 - 단일 가용 영역 내에서 지연시간이 짧은 하드웨드 설정, 인스턴스를 그룹화, 높은 성능제공, 위험 높음
  - 분산 배치(Spread) - 인스턴스가 다른 하드웨어에 분산, 가용 영역별로 분산된 배치 그룹당 7개 ec2 인스턴스 제한, 크리티컬 애플리케이션 있는 경우
  - 분할(Partition) - 여러 파티션에 인스턴스가 분할, 파티션은 가용 영역 내의 다양한 하드웨어 랙 세트에 의존, 분리 but 다른 실패로부터 격리 x/ but 파티션은 다른 오류 파티션과 격리 (Hadoop, Cassandra, Kafka)
  - 장단점
    - Cluster
      - 모든 EC2인스턴스 같은 하드웨어에 위치
      - 장점 : 네트워크 성능
      - 단점 : 랙이 실패시 모든 인스턴스 실패
      - 사용사례
        - 빅데이터 작업
        - 짧은 지연 시간과 높은 네트워크 처리량 애플리케이션
    - 분산 (spread)
      - 모든 EC2인스턴스가 다른 하드웨어에 위치
      - 장점 : 여러 가용영역에 걸쳐 사용 가능, 실패 위험 감소
      - 단점 : 가용 영역당 7개의 Instance 한계 존재, 규모에 재한
      - 사용 사례 : 가용성을 극대화, 위험을 줄여야하는 App, 크리티컬 App
    - 분할(Partition)
      -  여러 가용영역의 파티션에 인스턴스를 분산 가능
      - 최대 수백개 EC2 인스턴스 가능
      - 장점: 실패로 부터 격리, 
      - 단점: 
      - 사용사례 : 파티션들 전반에 걸쳐, 데이터와 서버를 퍼뜨려 두도록 파티션 인식 가능한 App, 빅 데이터 애플리케이션, HDFS, HBase, Cassandra, Apache Kafka

#### Elastic Network Interfaces (ENI) 

- 탄력적 네트워크 인터페이스
- VPC의 논리적 구성 요소
- 가상 네트워크 카드

- EC2 인스턴스가 네트워크에 액세스 가능토록
- ENI 속성
  - 주요 사설 IPv4와 하나 이상의 보조 IPv4
  - 각 ENI는 사설 IPv4당 탄력적 IPv4를 갖거나 혹은 하나의 공용 IPv4를 가질 수 있음
  - 하나이상의 보안그룹을 연결 가능
  - a Mac address 연결 가능
- EC2 인스턴스와 독립적으로 ENI를 생성하고 즉시 연결, 장애 조치를 위해 EC2 인스턴스에서 이동시킬 수 있음

#### EC2 Hibernate(절전 모드)

- 중지 - EBS 디스크 데이터 다시 시작할 때까지 유지
- 종료 - 루트 볼륨이 삭제되게 했다면 인스턴스 삭제 하지만 그렇게 설정하지 않은 다른 볼륨은 그대로 유지
- 다시 시작시 
  - 운영체제 부팅, 유저 데이터 스크립트 실행
  - 운영 체제 부팅
  - 애플리케이션 실행 시간 걸림
- 절전 모드
  - RAM에 있던 인 메모리 상태는 그대로 보존
  - 인스턴스 부팅이 빨라짐
  - RAM 경로에 인메모리 상태는 루트 경로의 EBS 볼륨에 기록 
  - 루트 EBS 볼륨을 암호화
  - 볼륨 용량도 RAM을 저장하기에 충분해야함
  - 사용사례
    - 오래 실행되는 프로세스를 갖고 있고 중지하지 않을 때
    - RAM 상태를 저장하고 싶을때
    - 빠르게 재부팅 하고 싶을 때
  - 절전 모드는 최대 60일

### 5. EC2  인스턴스 스토리지

#### EBS 볼륨

- Elastic Block Store Volume
  - 인스턴스가 실행 중인 동안 연결 가능한 네트워크 드라이브
  - EBS볼륨 사용 시 인스턴스가 종료 된 후에도 데이터를 지속 가능
  - CCP레벨
    - CCP 레벨하나의 EBS는 하나의 EC2 인스턴스에만 마운트 가능/
    - 어소시에이트 레벨 : 일부 EBS 다중 연결
  - 특정 가용 영역에서만 가능
  - 이론적으로 '네트워크 USB STICK'
- 네트워크 드라이브 (물리적 드라이브 X)
  - 사용하려면 네트워크를 필요
  - 지연 생길 수 있음
  - EC2 인스턴스에서 분리될 수 있고 매우 빠르게 다른 인스턴스로 연결 가능
- 특정한 가용 영역에 고정 
  - 서로 다른 가용 영역의 EBS사용 불가
  - 스냅샷을 이용하면 다른 가용 영역 볼륨 이동 가능
- 용량을 미리 정해야함 (GBs, IOPS(초당 전송 수))

#### EBS 스냅샷

- EBS 볼륨의 특정 시점에 대한 백업
- EBS 볼륨을 분리할 필요 없지만 권장사항
- 다른 가용 영역 다른 리전 복사 가능

- 기능
  - EBS Snapshot Archive
    - 최대 75%까지 저렴한 아카이브 티어
    - 복원하는데 24시간에서 최대 72시간
  - Recycle Bin for EBS Snapshot
    - 스냅샷을 삭제하는 경우 영구 삭제하는 대신에 휴지통에 넣을 수 있다
    - 휴지통에 서 복원 (1일에서 1년사이 보관기간 설정 가능)
  - Fast Snapshot Restore(FSR)
    - 바른 스냅샷 복원
    - 완전 초기화 첫사용의 지연시간을 없앰
    - 스냅샷이 아주크고 EBS 볼륨 또는 EC2 인스턴스를 빠르게 초기화해야 할때 특히 유용
    - 비용이 많이듬

#### AMI 개요

- AMI = Amazon Machine Image
- EC2 인스턴스를 통해 만든 이미지
- AWS 구축가능, 원하는 대로 변경 가능
  - 원하는 소프트웨어 또는 설정 파일 추가, 별도 운영체제 설정, 모니터링 툴 등등
  - 부팅 및 설정에 드는 시간을 줄일 수 있음
- AMI를 특정 지역에 구축 한 다음 다른지역에 복사 가능
  - 글로벌 인프라 활용 가능
- EC2를 여러 종류의 AMI에서 실행 가능
  - 전체 공개 AMI 사용 - AWS 제공
  - 직접 만드는 AMI - 유지, 관리도 직접
  - AWS 마켓플레이스 AMI  - 다른 사람이 구축한 이미지 사용, 보통 구매한 이미지
- AMI Process
  - EC2 인스턴스 Custom 설정
  - 인스턴스를 중지 (데이터 무결성 위해)
  - AMI 구축 - 과정 중 EBS 스냅샷 생성
  - AMI 인스턴스 실행 가능

#### EC2 Instance Store

- 해당하는 물리적 서버에 연결된 하드웨어 드라이브

- 사용이유 : EC2 인스턴스에 EBS(네트워크 드라이브) 연결 시 성능 한계 존재
  - I/O 성능
- 주의점
  - 인스턴스를 종료시 해당 스토리지 또한 손실 (임시 스토리지)
- 사용 사례
  - 버퍼/캐시/스크래치 데이터/ 임시 콘텐트
- 인스턴스의 기본 서버에 장애가 발생할시 연결된 하드웨어에도 손실
- 데이터 백업 복제 해야 함

#### EBS 볼륨 타입

- gs2/gp3
  - 범용 SSD볼륨 가격과 성능의 절충안
- io1/io2
  - 최고 성능의 SSD 볼륨, 지연시간이 낮고 대용량의 워크로드에 사용
- st1
  - 적은 비용의 HDD 볼륨, 잡은 접근과 처리량이 많은 워크로드에 사용
- 여러 요소로 타입을 결정
  - Size, Throughput, IOPS

- 오직 gp2/gp3 and io/io2로 부트 볼륨 사용 가능

- General Purpose SSD (gp)

  - 짧은 지연 시간을 자랑
  - 효율적인 비용의 스토리지
  - 시스템 부트 볼륨, 가상 데스크톱, 개발, 테스트 환경에서 사용가능
  - 1 GiB -16TiB

  - gp3: 최신 세대 볼륨 
    - 기본 성능으로 3,000 IOPS와 초당 125MB의 처리량을 제공
    - 각각 IOPS는 최대 16,000 처리량은 1,000MB/s 까지 증가 시킬 수 있음
  - gp2:
    - 최대 3,000 IOPS
    - 볼륨과 IOPS가 연결
      - IOPS가 증가하면 즉 볼륨의 GB 수를 늘릴 때, 세 배 더 증가한 16,000 IOPS가 된다는 의미
      - 가령 5,334GB 라면, 최대용량인 IOPS 16,000

- Provisioned IOPS SSD

  - 프로비저닝을 마친 IOPS
  - IOPS 성능을 유지할 필요가 있는 주요 비즈니스 애플리케이션
  - 16,000 IOPS 이상을 요하는 애플리케이션에 적합
  - 데이터베이스 워크로드 (스토리지 이용)
  - io 1/io 2 (4 GiB-16TiB)
    - Max PIOPS : Nitro EC2 최대  64,000 IOPS 가능 & 다른건 32,000
    - 프로비저닝된 IOPS를 스토리지 크기와 도가적으로 증가 가능
    - io2는 io1과 동일한 비용으로 내구성과 기기 당 IOPS의 수가 더 높음
  - io2 Block Express (4 Gib - 64 TiB)
    - 고성능 유형 볼륨
    - Max PIOPS: 256,000

- Hard Disk Drives (HDD)
  - 부트 볼륨일 수 없음
  - 125Mib to 16Tib
  - hdd로 구성
    - 빅 데이터나 데이터 웨어하우징 로그처리에 적합
    - Max throughtput 500MiB/s - max IOPS 500
  - Cold HDD (sc1):
    - 아카이브 데이터용
    - 최저 비용으로 데이터를 저장

#### EBS 다중 연결

- 하나의 EBS 볼륨을 같은 가용 영역에 있는 여러 EC2 인스턴스에 연결
- Only io 1/io2 family
- 각 인스턴스는 고성능 볼륨에 대한 읽기 및 쓰기 권한을 전부 가짐
- 사용사례
  - 애플리케이션의 효용성을 높이기위해 teradata처럼 클러스터링된 Linux 애플리케이션에서 사용
  - 애플리케이션이 동시 쓰기 기능 을 할 시
- 해당 가용영역 내에서만 사요가능
- 한 번에 16개 인스턴스만 
- 클러스터인식 파일 을 사용해야함 (XF5, EX4, etc...)

#### EBS 암호화

- EBS 볼륭 생성 시

  - 저장 데이터가 볼륨에 암호화

  - 인스턴스와 볼륨 간의 전송 데이터 역시 암호화
  - 스냅샷, 스냅샷으로 생성한 볼륨도 암호화

- 암복호화 매커니즘은 보이지 않게 처리

- KMS 암호화 키를 생성해 AES-256 암호화 표준 가짐

- 스냅샷을 복사해 암호화를 푼 걸 다시 암호화 활성화

- EBS 볼륨 암호화 및 암호화 풀기
  - 볼륨의 스냅샷 생성
  - 복사 기능을 사용해 EBS 스냅샷을 암호화
  - 스냅샷을 이용해 새 EBS 볼륨 생성 (해당 볼륨도 암호화)
  - 암호화된 볼륨을 인스턴스 원본에 연결

#### Amazon EFS - Elastic File System

- 관리형 NFS(network file systme)
  - 많은 EC2 인스턴스에 마운트 가능
- 서로 다른 가용성 영역의 EC2 도 가능
- 가용성, 확장성 뛰어남, 비쌈, GP2 EBS 볼륨의 약 3배
- 사용량에 따라 비용을 지불, 미리 용량을 프로비저닝 할 필요 X
- 사용사례
  - 콘텐츠 관리, 웹 서빙, 데이터 공유, Wordpress
- 내부적으로 NFS 프로토콜을 사용
- 액세스를 제어하려면 보안그룹 설정
- 윈도우가 아닌 Linux 기반 AMI와만 호환
- KMS를 사용, EFS 드라이브에서 미사용 암호화를 활성화 가능
- Linux 표준 파일 시스템
- 따라서 Posix 시스템 사용, 표준 파일 API 존재
- 용량 미리 계획 x
  - 자동으로 확장 사용하는 데이터 GB 사용량에 따라 비용 지불
- 다양한 성능 및 스토리지 클래스
  - EFS Scale
    - 동시에 NFS 클라이언트 수천 개와 10GB 이상의 처리량을 확보 가능
    - PB 규모의 네트워크 파일 시스템으로 자동 확장 가능
  - 성능 모드
    - 범용 : 기본값, 지연 시간에 민감한 사용 사례에 사용 (웹서버나 CMS등)
    - MAX I/O : 처리량을 최대화, 지연시간이 긴 네트워크 파일 시스템, 처리량, 병렬성 높음
  - 처리량 모드
    - 버스팅 - 1 TB = 50MiB/s + 100MiB/s 버스트
    - 프로비저닝 - 스토리지 크기에 관계없이 처리량을 설정하고 싶은 경우
    - 엘라스틱 - 워크로드에 따라 처리량을 자동으로 조절
      - 워크로드를 예측하기 어려울때 유용
  - Storage Classes
    - Storage Tiers (며칠 후 파일을 다른 계층으로 옮길 수 있는 기능)
      - 표준 계층: 자주 액세스 하는 파일을 위한 계층
      - EFS-IA : 자주 액세스 하지 않는 파일을 위한 계층
        - 이 계층에서 파일을 검색할 경우 비용 발생
    - 가용성과 내구성
      - 표준 : Multi-AZ, 프로덕션 사용 사례에 적합
      - One Zone EFS: 하나의 AZ, 개발용, 백업 기본적으로 활성화, (EFS One Zone-IA)
        - 약 90% 할인

#### EBS vs EFS

- EBS 볼륨
  - 한 번에 하나의 인스턴스에 첨부(except multi-attach io1/io2)
  - AZ 수준에서 Lock
  - g2 : 디스크 크기가 증가하면 IO가 증가
  - io1 : 독립적으로 IO 늘릴수 있음
  - EBS 볼륨을 마이그레이션 하려면 스냅샷만들어야함
    - 스냅샷을 사용하면 다른 AZ로 복원 할 수 있음
    - 백업은 IO를 사용하므로, 애플리케이션이 많은 트래픽을 처리하는 경우에 실행X
  - 인스턴스틔 루트 EBS 볼륨은 EC2 인스턴스가 종료되면 기본적으로 종료
    - 비활성화 가능
- EFS
  - 네트워크 파일 시스템
  - 여러 가용성 영역에 걸친 수백개의 인스턴스에 첨부하는 파일을 관리
  - website file을 공유
  - 오직 Linux 인스턴스만 사용 가능
  - EBS보다 가격대가 높지만 EFS-IA 기능을 활용, 비용절감 가능

### 6. 고가용성 및 스케일링성

#### 고가용성과 확정상의 개요

- 고가용성 : app / 시스템이 조정을 통해 더 많은 양을 처리할 수 있다는 의미
-  확장성
  - 수직 확장성
  - 수평 확장성 (=탄력성)

#### 수직 확장성

- 인스턴스의 크기를 확장하는 것
- ex) t2.micro -> t2.large
- 데이터베이스와 같이 분산되지 않은 시스템에서 흔히 사용
- RDS, ElastiCache 등
- 하드웨어 제한으로 확장할수있는것에 한계 존재

#### 수평 확장성

- 애플리케이션에서 인스턴스나 시스템의 수를 늘리는 방법
- 분배 시스템 필요

### 고가용성

- 애플리케이션 또는 시스템을 적어도 둘 이상의 AWS의 AZ나 데이터 센터에서 가동 중이라는 걸 의미
- 목표 : 데이터 센터에서의 손실에서 지킴
- 센터 하나가 멈춰도 계속 작동
- 수동적인 고가용성 :  RDS 다중 AZ 
- 활성형 고가용성 : 수평확장 하는 경우

#### EC2경우 고가용성,확장성

- 수직확장 :인스턴스의 크기를 늘림 (= scale up / down) 
  - 가장작은 t2.nano - 0.5G of RAM, 1 vCPU
  - 가장큰 u-12tb1.meta1 - 12.3TB of RAM, 448 vCPUs
- 수평확장 : 인스턴스의 수를 늘림 (= scale out /in)
  - 자동 스케일링 그룹
  - 로드 밸런서
- 고가용성 : 동일 애플리케이션의 동일 인스턴스를 다수의 az걸쳐 생성
  - 다중 AZ가 활성화된 스케일링 그룹
  - 다중 AZ가 활성화된  로드 밸런서

#### Elastic Load Balancing (ELB)

- load balancing?

  - 서버 혹은 서버셋으로 트래픽을 백엔드나 다운스트림 EC2 인스턴스 또는 서버들로 전달하는 역할 

  - 사용이유

    - 부하를 다수의 다운스트림 인스턴스로 분산하기 위함

    - 단일 액세스 지점(DNS)을 노출하게 되고 다운스트림 인스턴스의 장애를 원활히 처리 가능
    - 인스턴스의 상태 확인
    - ssl 종료 가능 웹 사이트에 암호화된 HTTPS 트래픽을 가질수 있음
    - 쿠키로 고정도 강화 가능
    - 영역에 걸친 고가용성 가짐
    - 클라우드 내에서 개인 트래픽과 공공 트래픽 분리 가능

- ELB 사용 이유

  - 관리형 로드 밸런서
    - AWS관리어떤 경우에도 작동
    - AWS가 업그레이드와 유지 관리 및 고가용성 책임
    - 로드 밸런서의 작동 방식을 수정 가능하도록 일부 구성 놉도 제공
  - 자체 로드 밸런서를 마련하는 것보다 저렴
  - 관리, 확장성 더 좋음
  - 다수의 AWS의 서비스들과 통합
    - EC2 인스턴스, EC2 Auto Sacling Groups, Amazon ECS 등등등

- 상태 확인 (Health Checks)
  - 일래스틱 로드 밸런서가 EC2 인스턴스의 작동이 올바르게 되고 있는지 여부 확인하기 위해 사용
  - 포트와 라우트에서 이뤄짐
  - 200으로 응답하지 않은다면, 상태가 좋지않다고 기록, 그쪽으로 트래픽 보내지 X
- AWS의 로드밸런스의 종류
  - Classic Load Balancer (v1 - old generation) - 2009 -CLB
    - HTTP, HTTPS, TCP, SSL (secure TCP)
  - Application Load Balancer (v2 - new generation) - 2016 - ALB
    - HTTP,HTTPS,Websocket
  - Network Load Balancer (v2 - new generation) - 2017 - NLB
    - TCP,TLS (secure TCP), DUP
  - gateway Load Balancer - 2020 - GWLB
    - 3계층 (네트워크 레이어) - ip protocol
  - 신형 로드 밸런서를 쓰는 것을 권장
  - 일부 로드 밸런서들은 내부에 설정될 수 있어 네트워크에 개인적 접근 가능
  - 외부 공공 로드 밸런서도 존재

- 로드 밸런서 보안 그룹
  - HTTP나 HTTPS를 사용해 어디서든 로드 밸런서에 접근 가능
  - EC2의 보안그룹을 로드밸런서의 보안 그룹으로 연결





>궁금하거나 주요한 사항
>
>- EC2 전용 호스트와 전용 인스턴스 차이
