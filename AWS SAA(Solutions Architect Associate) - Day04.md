# 24/7/12 AWS SAA(Solutions Architect Associate) - Day04

## RDS+Aurora+Elasticache


### 1. RDS + Aurora + Elasticache, Route53

#### Amazon Aurora

- Replicas Auto Scaling
  - cpu가 늘어나면 자동확장
- custom endpoint
  - Aurora 인스턴스의 부분집합을 사용자 지정 엔드포인트로 정의
  - ex) custom endpoint 지정,사이즈가 큰 복제본들이 분석적 쿼리를 담당 
  - custom endpoint 정의 이후 리더 엔드포인트 자체는 사용x

- 서버리스
  - 자동화된 데이터베이스 예시화와 실제 사용량에 따른 Auto Scaling을 제공
  - 간헐적이고 예측 불가능한 업무량에 대응 하는것을 도와줌
  - 용량 계획 필요 x
  - 초당 비용 지불, 훨씬 비용 효율적
- 글로벌 오로라
  - 모든 읽기와 쓰기가 일어나는 하나의 기본 리전
  - 최대 5개의 보조 읽기 전용 리전 생성 가능(응답지연 1초이하)
  - 보조 리전 당 최대 16개의 읽기 전용 복제본 사용 가능
  - 전 세계에서 오는 읽기업무량에 따른 대기시간 줄임
  - 한리전 에러시 재해복구를 위해 다른 리전을 진급(1분이내)
  - 한 리전에서 다른리전으로 데이터를 복제하는데에 1초

- 오로라 머신 러닝
  - sql 인터페이스를 통해 응용프로그램에 기계 학습 기반의 예측 추가가능
  - 제공되는 서비스
    - Amazon SageMaker
      - 백엔드인 어떤 종류의 기계학습 모델이라도 사용 가능
    - Amazon Comprehend
  - 기계학습 경험 필요x
  - 사용사례
    - 이상 행지 탐지, 광고 타겟팅, 감정분석, 상품 추천

#### RDS Backups

- 자동화된 백업
  - 자동으로 매일 데이터베이스를 백업
  - 5분마다트랜잭션 로그 백업
  - 5분 전으로 언제라도 ㅂ복원가능
  - 보존 기간 1~35일
    - 0면 사용 x
- 수동 스냅샷
  - 사용자가 수동 트리거
  - 원하는 기간동안 유지
- 비용절감 . 스냅샷으로 2시간 사용후 db삭제
- 오로라 백업
  - 자동화된 백업
    - 1~35일
    - 비활성화x
  - 시점 복구 기능
    - 해당시점 어느곳
  - 수동 스냅샷
    - RDS비슷
- 복원 옵션
  - 새 데이터베이스로 복원 가능
  - S3에서 MySQL 데이터베이스를 복원가능
    - 온프레미스 데이터베이스 백업을 생성 후 S3(객체 스토리지)에 배치
  - S3에서 백업 파일을 복원 가능
    - 온프레미스를 다시 백업,외부적으로 Percona XtraBackup이라는 소프트웨어로
    - Percona XtraBackup파일 S3 로 전송
- 오로라 데이터베이스 복제
  - 기존 데이터베이스 클러스터에서 새로운 Aurora 데이터베이스 클러스터 생성 가능
  - 스냅샷 복원보다 빠름 
  - copy-on-write 프로토콜을 사용
    - 복제시 동일한 데이터 볼륨을 사용
    - 업데이트가 이루어지면 새로운 추가 스토리지가 할당,분리
  - 빠르고, 비용 효율적, 프로덕션 db 영향 x, 복제 하는데 매유 유용

#### Security

- 저장된 데이터를 암호화
  - 볼륨에 암호화
  - kms사용 데이터베이스를 처음 실행할 때 정의
  - 주 데이터베이스(마스터)를 암호화 하지 않았다면 읽기 전용 복제본 암호화 불가
  - 암호화 되어있지 않은 기존 데이터베이스를 암호화 하려면 스냅샷을 가지고와서 암호화된 형태로 다시 복원
- 클라이언트와 데이터베이스간의 전송중 데이터 암호화
  - 기본적으로 전송중 암호화, AWS의 TLS루트 인증서 사용 필
- IAM역할
  - 사용자 이름 필요없이 인증 가능
- 보안 그룹
  - 네트워크 엑세스 컨트롤
- NO SSH
  - RDS Custom은 제외
- 감사 로그

#### RDS 프록시

- 완전 관리형 RDS 데이터베이스 프록시 배포가능
- 프록시를 사용시, 애플리케이션이 데이터베이스 내에서 데이터베이스 연결 풀을 형성하고 공유 가능
- 리소스 부담 줄여 데이터베이스 효율성 향상, 개방된 연결과 시간초과를 최소화
- 완전한 서버리스 / 오토스케일링 가능, 용량 관리 필요 X 가용성 HIGH, 다중 가용영역됨
- 장애 조치가 발생하면 기본인스턴스가 아니라 대기 인스턴스 조치 시간을 66%까지 줄임 가능
- RDS (MySQL, PostgreSQL, MariaDB) 가능 Aurora(MySQL,PostgreSQL)

- 애플리케이션 코드 변경 없이 프록시에 연결하기만 하면됨
- IAM 인증을 강제 인증 통해서만 RDS 데이터베이스 인스턴스에 연결 가능
  -  자격증명은 Amazon Service Manager에 안전하게 저장
- 퍼블린 액세스가 불가능 vpc에서만 가능

#### Amazon ElastiCche

- 개념

  - 캐싱 기술인 Redis 또는 Memcached를 관리 할수 잇도록 도움

  - 캐시는 매우 높은 성능과 짧은 지연 시간을 가진 인메모리 데이터베이스

  - 읽기 집약적인 워크로드에서 데이터베이스의 로드를 줄여줌

  - 일반적인 쿼리는 캐시에 저장, 매번 데이터베이스를 쿼리하지 않아도

  - 애플리케이션을 상태 비저장형으로 할 수있게 도와줌

  - RDS와 동일한 이점, 패치, 최적화, 설정, 구성, 모니터링, 장애 복구, 백업

  - 사용하는 경우, 애플리케이션의 코드를 많이 바꾸어ㅑ함

- 아키텍쳐
  - 애플리케이션 <-> ElastiCache : 캐시 히트
    - 쿼리를 수행하기 위해 데이터베이스로 이동하는 시간이 절약
  - 애플리케이션 -->실패시 : 캐싱 미스
    - 발생시 데이터베이스에서 데이터 조회
  - 캐시 무효화 전략이 있어야함
    - 가장최신데이터만 사용되어야
  - 사용자 세션 저장에도 사용
- Redis Vs Memcached
  - Redis
    - 자동 장애 조치 기능이 있는 다중 AZ가 있고, 일기 복제본 있음
    - AOF 지속성을 위한 데이터 내구성 유
    - 백업 및 복원 기능
    - 데이터 내구성에 대한것
      - 캐시로서, 세트 및 정렬된 세트를 지원
  - Memcached
    - 데이터 분할을 위해 멀티 노드를 사용 (샤딩)
    - 고가용성 x 복제가 x , 영구 캐시 x
    - 백업x 복원 x
    - 멀티 스레드 아키텍처

- 보안
  - Redis에서만 IAM인증을 지원, 나머지 경우에는 사용자 이름과 비밀번호를 요구
  - IAM정책을 정의하면 AWS API 수준 보안에만 사용
  - Redis AUTH : Redis 내 보안을 통해 비밀번호와 토큰을 설정 가능
    - ssl전송 중 암호화도 지원
  - Memcached 
    - SASL 기반 승인을 제공
- 로드 패턴
  - 지연 로딩
    - 모든 데이터가 캐시되고 데이터가 캐시에서 지체
  - Write Through
    - 데이터베이스에 데이터가 기록 될때마다 캐시에 데이터를 추가하거나 업데이트
  - 세션 스토어
    - 유지 시간 기능을 사용해 세션을 만료
- 사용 사례
  - 게이밍 리더보드 만들기
  - 레디스에는 정렬된 세트가 있음
    - 고유성과 요소 순서를 모두 보장
  - 요소가 추가될때마다 실시간으로 순위를 매긴다음 올바른 순서로 추가

### 2. Route 53

#### DNS

- 도메인 네임 시스템 : 사람들에게 친숙한 호스트 이름을 대상 서버 IP주소로 번역
- 인터넷의 중추
- 계층적 이름 구조 존재
- 도메인 레지스트라
  - 도메인 이름을 등록하는 곳
    - Amazon Route 53, GoDaddy...
- DNS 레코드 : A,AAAA,CNAME,NS,...
- Zone File : DNS 레코드를 포함
- Name Server : DNS 쿼리를 실제로 해결하는 서버
- Top Level Domain (TLD) : .com, .us, .in,.org 등
- second Level Domain (SLD) : google.com
- 서브 도메인 : www.google.com
- 도메인 이름 : api.www.google.com
- 마지막을 루트
- 전체를 FQDN

#### Route 53

- 고가용성, 확장성을 갖추느 완전히관리되며 원한있는 DNS
  - 고객이 DNS레코드를 업데이트 가능
- 루트 53은 도메인 레지스트라
- 리소스 관련 상태 확인 가능
- 100 % SLA 가용성을 제공하는 유일한 AWS서비스
- 53 DNS 포트
- 레코드
  - 레코드를 통해 특정 도메인으로 라우팅하는 방법을 정의
  - 각 레코드 
    - 도메인이나 google.com 같은 서브도메인 이름과 같은 정보 가짐
    - 레코드 타입 -ex_ A or AAAA
    - 값 - ex_ 123.456.789.123
    - 라우팅 정책
    - TTL - DNS 리졸버에서 캐싱 얼마나 걸리는지
  - 레코드 타입
    -  A/AAAA/CNAME/NS 는 알아야함
    - CAA/DS/MX/NAPTR/PTR/SOA/TXT/SPF/SRV (고급)

- 레코드 종류
  - A - IPv4와 매핑
  - AAAA - IPv6와 매핑
  - CNAME - 호스트 이름을 다른 호스트 이름과 매핑
    -  대상 호스트 이름은 A나 AAAA 레코드 가능
    - www.example.com은 불가 example.com은 가능
  - NS : 호스팅존의 이름 서버
    - 트래픽이 도메인으로 라우팅 되는 방식을 제어

- 호스팅 존
  - 레코드 컨테이너
    - 도메인과 서브도메인으로 가는 트래픽의 라우팅 방식을 정의
  - 퍼브릭 호스팅 존
    - 도메인 아이디의 IP가 무엇인지 알수 있음
  - 프라이빗 호스팅 존
    - 공개되지 않은 도메인 이름을 지원
    - VPC만이 URL을 리졸브
  - 어떤 호스팅 존이라도 월에 $0.50 지불 필수
