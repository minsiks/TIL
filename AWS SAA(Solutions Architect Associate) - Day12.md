# 24/7/26 AWS SAA(Solutions Architect Associate) - Day12

## 머신러닝, 모니터링 및 감사, IAM 고급

### 1. AWS 보안 및 암호화

#### 디도스 방어

- BP 1 - CloudFront
  - 엣지 로케이션 완화
- BP1 - Global Accelerator
  - 전세계 엣지를 통해 애플리케이션 액세스 가능
  - 백엔드랑 호환 안되서 ddos방어
- bp3 - route 53
  - 도메인 글로벌로 ddos 보호
- 완화 모범 사례
  - b1,b3,b6
  - 오토스케일링
  - 엘라스틱 로드 밸런싱 (bp6)
- 계층방어 
  - bp1,bp2
    - waf로 ㅡ특정 ip만
    - waf에 규칙 설정
  - shied advenced
- 공격지점 줄이기
  - aws 리소스 숨기기 (bp1,bp4,bp6)

#### Amazon GuardDuty

- 지능형 위협 탐지를 이용해 aws 계정 보호
- 머신러닝 알고리즘 있어서 탐지
- 한번 클릭이면 됨
- 입력 데이터
  - cloudtrail events log
  - vpc flow logs
  - dns logs
  - optional features
- 자동으로 알람 가능 eventbridge에서
- 암호화폐 공격을 방어하기 위한 아주 좋은 도구
- 전문적인 탐지 기능 제공

#### Amazon Inspector

- 자동화된 보안 평가를 실행 할 수 있는 서비스
- ec2
  - 시스템관리자 에이전트를 사용하면 보안을 평가
  - 취약점 분석
- 컨테이미지를 amazon ecr로 푸시할 때 실행
- 람다 함수
  - 람다함수가 배포될때 소프트웨어 취약성을 검사
- 보안 허브에 보고
- 결과 이벤트를 eventBridge에 전송
- 필요한 이벤트에만 지속적으로 검사 (ec2, 컨테이너 이미지 & 람다 함수)
- 취약한 데이터베이스 cve

#### Amazon Macie

- 완벽히 관리되는 데이터 보안 및 데이터 프라이버시 서비스
- 머신 러닝과 패턴 매칭을 이용

​	개인식별정보, 민감정보 경보 제공

### 2. VPC

#### CIDR, 공개 비공개 IP

- CIDR
  - 클래스 없는 도메인간 라우팅 
  - IP주소 할당
  - 단순한 IP 범위를 설정
  - 구성요소
    - 기본 IP
      - 범위의 포함
      - 10.0.0.0
    - 서브넷 마스크
      - 변경 가능한 비트수를 제공
      - EX: /0,/24
      - 두가지 형식
        - /8 = 255.0.0.0
        - /16 = 255.255.0.0
      - 기본 IP에서 변경할 수 있는 값을 지정
- 공용 VS 사설 IP
  - 사설 IP 는 특정 값만 지정

#### VPC

- 새로운 계정은 다 VPC가 있음
- VPC는 처음부터 인터넷에 연결
- 공용 IPv4를 얻음
- dns도 잇음
- 단일 aws 리전에 여러 vpc 둘 수있음
  - 최대 5개인데 늘릴ㄹ 수잇음
- virtual Private Cloud
- cidr 5개
- 사설 리로스기 때문에 사설 IPV4로만 됨

#### 서브넷

- 내부에있는 ipv4의 부분 주소
- /27은 사용 못함 5개의 ip는 미리 예약

#### 인터넷 라우팅

- 인터넷 게이트 웨이
  - 리소스를 인터넷에 연결
  - ec2, 람다함수
  - vpc와 별개로 생성

#### Bastion 호스트

- ec2  인스턴스
- ec2 인스턴스에 ssh로 액세스 가능
- 배스천 호스트는 반드시 퍼블릭 서브넷에 존재
- 보안그룹이 반드시 인터넷 액세스를 허용
  - 회사 펍르릭 cidr 액세스만 하던지 제한
- 프라이빗 서브넷의 인스턴스는 ssh액세스를 허용해야함

#### NAT instnace

- Nat = 네트워크 주소 벼환
- 사설 서브넷 EC2 인스턴스가 인터넷에 연결되게함
- 공용 서브넷에 실행되어야 하고
- 고정된 탄력 ip가 필요
- 가용성이 높지 않아 복잡
- 보안 그룹과 규칙으로 관리

#### NAT 게이트웨이

- 훨씬 좋은 기능
- 가용성 높고 관리 필요없음
- 대역폭에 따라청구
- 특정  az 생성 
- 다른서브네셍서 만들때 연결 좋음
- 보안그룹을 관리할 필요 없음
- 고가용성
  - 단일 az에서 복원 가능
  - 단일 az 중복가능
  - 여러 nat gateway를 사용하면 다중 az가능

#### NACL & 보안그룹

- NACL
  - 서브넷 단계의 보안 
  - 네트워크 액세스 컨트롤 리스트
  - 룰
    - 숫자 1-32766 중요도에 따라
    - 우선순위
    - 별표면 전체
  - 기본적으로 다 거부
  - 서브넷 수준에서 특정 ip 거부 유용
  - 기본NACL
    - 연결된 서비스를 가지고 인바운드 아웃바인드 모두 허용
    - 매우 개방정
    - 수정하지 않는걸 추천
  - 임시 포트
    - 클라이언트와 서버가 연결되면 포트가 피요
    - 서버가 서비스를 올릴때 포트로 접속
    - 기본적으로 오픈된 포트 x
    - 임시포트는 운영체제에 따라 범위 달라짐

#### VPC 피어링

- 다양한 리전과 계정에서 AWS 네트워크를 통해 연결 하고 싶을때 사용
- 모두 같은 네트워크에서 사용하기 위함
- 연결 하고 싶지 않다면 cidr가 떨어져야함
- 두 vpc 간에 발생
- 다른계정간에도 가능

#### VPC 엔드포인트

- AWS 서비스는 공용에 노출되어있고 공용 URL받음
- VPC 엔드포인트를 사용하면 AWS PrivateLink를 통해 프라이빗으로 액세스
- VPC 엔드포인트는 중복과 수평 확장이 가능
- 인터넷 게이트웨이나 NAT 게이트웨이 없이도 서비스에 액세스
- 문제가 발견하면
  - 라우팅테이블이나확인
- 유형
  - 프라이빗 링크를 이용하는 인터페이스 엔드포인트
    - ENI를 프로비저닝
    - 보안그룹을 연결
    - 대부분의 AWS서비스
    - 시간당 돈 + 기가당 돈
  - 게이트웨이 엔드포인트
    - 게이트웨이를 프로비저닝
    - 반드시 루트 테이블의 대상
    - S3, DynamoDB 두가지 대상
    - 요금 무료

#### VPC Flow logs

- 인터페이스로 들어오는 IP 트래픽에서 정보 포착가능
  - VPC 수준
  - 서브넷 수준
  - 탄력적 네트워크 인터페이스 수준
- 연결문제 모니터링
- 로그를 여러군데에 연결 가능
- 전송도가능
- 문법
  - 소스 주소와 대상주소 : 문제가 있는 ip 식별에 도움
  - 소스포트 대상포트
  - 액션 : 성공 혹운 실패 여부
  - 쿼리 하는 방법은 athena를 s3에 쓰는게 베스트

#### Site-to-Site VPN

- VGW
  - 가상 프라이빗 게이터웨이
  - VPN 연결에서 AWS 측에 있는 VPN 집선기
  - 생성되면 VPC로 연결
- CGW
  - 고객 게이트웨이
  - 소프트웨이 등으로 VPN연결
- VPN Cloudhub
  - 모든 연결간 안전 보장

#### 다이렉트 커넥트(DX)

- VPC로의 전용 프라이빗 연결을 제공
- 전용 연결을 생성해야함
- AWS Direct Connect 로케이션을 사용
- 가상 프라이빗 게이트웨이 설치해야함
- S3 EC2등의 퍼블릭 및 프라이빗 연결 가능
- 사용사례
  - 프라이빗 연결을 바로 하면 비용절약
  - 실시간 데이터 피드 유용
- ipv4,6 다 허용

- 다른 리전에 있는 하나 이상의 VPC와 연결 하고 싶으면 DirectConect Gateway 사용해야함
- 유형
  - 전용 연결 : 초당 1Gbp 혹은 10Gbp한도
    - 고객은 물리적 전용 이더넷 포트를 할당
  - 호스팅 연결 : 500Mbp~ 10gbp
    - 필요하면 언제나
    - Direct Connect 파트너를 통해 연결 요청
  - 새연결을 만들려면 리드 타임이 한달 보다 길때도 있음
- 암호화
  - 암호화 없음
  - 프라이빗 연결
  - 암호화 뭔한다면 vpn설정 ipsec으로
- 복원력
  - 복원력

#### 환승 게이트웨이

- 전이적 피어링 연결이 VPC 수천개와 연결 사이에 생성
- 리전 리소스
- 계정과 공유하려면 RAM 필요
- 루트 테이블로 제한
- AWS에서 유일하게 IP 멀티캐스트 지원
- 사용 사례
  - ECMP : 등가 다중 경로 라우팅
    - 여러 최적 경로를 통해 패킷을 전달하는 방법
    - VPN연결을 많이 생성 , 연결 대역폭을 늘릴 때 사용

#### VPC 트래픽 미러링

- VPC에서 네트워크 트래픽을 수집,검사 

#### IPv6 in vpc

- ipv6
  - 수십억개가 ipv4가 다 소진
  - 모두 공용, 사설 범위 없음
  - 16진수 8자리로 이뤄짐
- vpc와 서브넷에서 ipv4 비활성은 불가능
- ipv6활성화 가능 듀얼스택모드 가능
- 트러블 슈팅

#### 이그레스 전용 인터넷  게이트웨이

- ipv6전용
- 아웃바운드 허용
- 라우팅 테이블 업그레이드 필요

#### 요약

- cidr : ip 범위
- vpc
- 서브넷
  - 프라이빗 퍼블릭
- 인터넷 세이트웨이
- 루트 테이블

#### 네트워킹 비용

- 속도는 높이고 비용을 줄이려면 사설 ip 사용
- 공용 ip보다 사설 ip
- 같은 가용 영역을 사용하여 가격 줄임
- 송신 트래픽 비용을 줄이는것이 좋음
  - 같은 az로 해서
- s3 버킷 비용
  - 수신은 무료
  - 데이터 내려받는건 비용
- 네트워크 파이어월
  - 전체 VPC를 방화벽으로 보호
  - 계층3에서 7까지 보호
  - 
