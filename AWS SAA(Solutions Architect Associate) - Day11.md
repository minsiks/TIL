# 24/7/25 AWS SAA(Solutions Architect Associate) - Day11

## 머신러닝, 모니터링 및 감사, IAM 고급

### 1.머신러닝

#### Amazon Comperhend

- 자연어를 처리하는 NLP 서비스
- 완전 관리형 서버리스 서비스
- 머신러닝
  - 텍스트 언어를 이해
  - 주요문구장소 살람등 분석
- 사용사례
  - 고객 이메일
  - 분석한내용으로 문서 생성 가능

#### Comprehend Medical

- 비정형 의료 텍스트에서 유용한 정보를 반환
  - 의사소견서 등
- S3에 문서 저장

#### SagaMaker

- 완전 관리형 서비스
- 머신 러닝 모델을 구축하는 개발자와 데이터 과학자를 위한 서비스

#### Forecast

- 완전 관리형 서비스
- 머신 러닝을 사용하여 매우 정확한 예측을 제공
- 제품 수요계획 등

#### Kendra

- 완전관리형 문서 관리 서비스
- 문서 검색 서비스

#### Personalize

- 완전 머신 러닝 서비스
- 실시간 맞춤화 추천으로 애플리케이션을 구축
  - 추천

#### Textract

- 텍스트를 추출

### 2. 모니터링 및 감사

#### CloudWatch Metircs

- CloudWatch는 모든 서비스에 대한 지표 제공
- 지표(Metric)는 변수
- 지표는 이름공간에 속함
- 측정 기준 : 지표의 속성
- 지표당 최대 측정기준 30개
- 태임스탬프가 꼭 이썽야함
- 스트림
  - 지표를 원하는 대상으로 지속적으로 스트리밍하면 실시간으로 전송, 지연시간 짧아짐
    - Kinesis Data Firehose

#### CloudWatch Logs

- 애플리케이션 로그를 저장하는곳
- 로그그룹 
- 로그 스트림 : 로그인스턴스나 로그 파일이 있는 컨테이너
- 로그 만료 정책을 정의
- 다양한 대상에도 전송 가능
  - s3
  - 등
- 암호화
- sdk,CloudWatch Logs Agent, CloudWatch Unitied Agent 전송가능

- Elastic Beanstalk : 애플리케이션과 연결 가능
- ECS : 컨테이너에서 클라우드 워치로 보냄
- 람다 함수자체에서 전송
- VPC
- API Gateway
- Route S3
- 로그 인사이트
  - 로그를 시각화함
  - 검색하고 분석가능
  - 샘플쿼리 많음
  - 쿼리 언어를 제공
    - 필터링 계산 정렬 다 가능
  - 대시보드에 추가가능
  - 실시간 엔진이 아니라 쿼리 엔진
- S3 Export
  - 완료 될때까지 최장 12시간까지
  - CreateExport Task
  - 근 실시간이나 실시간이 아님
- CloudWatch Logs Subscription
  - 로그 이벤트들의 실시간 스트림을 얻고, 처리 분석 가능
  - 다양한 곳에 보낼 수있음
  - 필터로 필터링 가능

- CloudWatch Logs for EC2
  - 기본적으로는 어떤 로그도 옮기지지 않음
  - EC인스턴스에 에이전트라는 프로그램 실행 로그파일 푸시
  - IAM 역할로 열어줘야함
  - 온프레미스 환경에서도 셋업 가능
- 통합 CloudWatch 에이전트
  - 온프라미스 ec2 버전 다 가능
  - CloudWatch Logs Agent
    - 좀더 오래된 버전
    - 로그만 보냄
  - 통합 에이전트
    - 프로세스나 램 같은 추가적인 시스템 단계 지표 보냄
    - 로그도 보냄
    - SSM 파라미터로 에이전테를 쉽게 구성
  - 지표
    - cpu
    - disk
    - ram
    - netstat
    - processes
    - swp space

- Alarms
  - 매트릭에서 나오는 알람을 트리거하는데 사용
  - 샘플링,퍼센티지,최대,최소등 옵션이있음
  - 상태
    - ok
    - insufficeint_data
    - arlaam
  - 기간
  - 타겟
    - EC2
    - 오토스케일링
    - SNS 서비스
  - 복합 알람
    - 다수의 매트릭이랑 사용
    - AND OR 조건
    - 알람 노이즈를 줄이는데 유용
  - 복구
    - 상태 체크
- EventBridge
  - CRON 작업을 예약 가능 (스크립트 예약 가능)
  - 이벤트 패턴에 반응가능
    - 예 ) 로그인
  - LAMDA 트리거 가능
  - JSON 형태
  - 스키마 레지스트리 라는것이 있다
    - 버스 이벤트를 분석
  - 스키마를 버저닝 할수도있음
  - 리소스 기반 정책
    - 특정 이벤트 버스의 권한을 관리 가능

- Insight 유형
  - Container Insighs
    - 컨테이너로부터 지표와 로그를 수집, 집계함
    - 사용가능
      - ECS
      - EKS
      - EC2
      - FARGATE
  - Lambda insights
    - 람다에서 실행되는 서버리스 애플리케이션을 위한 모니터링과 트러블 슈팅 솔루션
    - CPU 시간, 메모리 디스크, 네트워크 등 지표를 집계 요약
    - 함수의 선능을 모니터링
  - Contributor Insights
    - 기고자 데이터를 표시하는 시계열 데이터 생성 로그를 분석
    - 네트워크 성능에 영향을 미치는 사용자 찾을 수 있음
    - VPC 로그, DNS 로그 등 모든 로그에서 작동
    - 불량 호스트를 식별 가능
    - 규칙 직접 새엉하거나 간단 생성됨
  - Application Insights
    - 애플리케이션의 잠재적인 문제나 문제를 모니터링
    - 자바나 넷 특정 언어로 실행가능
    - aws리소스 다양한거에 연동 가능
    - 애플리케이션 문제 있을시 대시보드에 생성
    - 내부에는 세이지 메이커가 사용됨
    - 트러블 슈팅이나 보수하는 시간 줄어듬
    - 발견된 문제나 그런건 eventBrige로 감

#### CloudTrail

- AWS 계정의 거버넌스, 컴플라이언스, 감사를 실현하는 방법
- 기본값으로 활성화
- 계정안에서 일어난 모든이벤트와 API 호출 이력 가져옴
  - Console
  - SDK
  - CLI
- 로그들을 S3에 넣을 수 있음
- 모든 리전에 걸쳐 누적된 이베느 이력을 특정한 S3 버킷에 넣고시으면  트레일을 생성해서 모든 리전 가능
- 이벤트
  - 관리 이벤트
    - 리소스에 대해 수행된 작업들을 나타냄
    - 서브넷을 만들면 나오고 로깅을 만들어도 나옴
    - 트레일은 모든 관리 이벤트를 로깅하도록 설정
    - 리소스 변경하지 않는 읽기 이벤트와 리소스수정가능한 쓰기 이벤트
  - 데이터 이벤트
    - 별도, 기본값으로 데이터 이벤트는 로깅 X
    - 고용량 
    - S3 버킷에대해서
    - 읽기 ,쓰기 이벤트 있음
    - AWS람다 활동에대해도 실행
  - 클라우드트레일 인사이트 이벤트
    - 비용을 지불하고 활성화
    - 계정에서 일어나는 이벤트를 분석, 비정상적인 활동에 대한 탐지 시도
      - 부정확한 리소스 프로비저닝
      - 서비스 한도 도달
    - 기준선을 만듬
    - 계속적인 분석
    - 패턴 감지
    - S3로 보낼 수 있음
    - 자동화 필요하면 EdgeBridge
  - 보관
    - 기본값으로 90일
    - 이후 보관하려면 S3로 보내야함

#### AWS Config

- 리소스에 대한 감시, 규정 준수 여부를 기록할 수 있음
- 구성과 구성의 시간 기록 가능
- 빠르게 롤백 가능
  - ssh
  - 버킷 
- 변화가 생길때마다 sns 알림 가능
- 계종 통합 가능
- s3에다가 나중에 
- 규칙
  - aws 관리형 룰 (75개 이상) 
  - 스스로 규칙 만들어도 됨
  - 구성이 변화될대마다 트리거
  - 규칙은 규정 준수를 위해 어떤 동작을 미리 예방,차단 할 수없음
  - 결제해야하고 꽤 비쌈
- 리소스
  - 리서스 구성 
  - 리소스 api callㅂㄹ수있음
- 자동화 문서
  - 규정하지 않은 리소스에서 수정가능
- 알림
  - 미준수 했을 때 알림 전송
  - sns로 보낼 수도 있음

### 3. IAM 고급

#### AWS 조직

- 글로벌 서비스
- 조직을 생성하면 조직의 메인 계정 관리 계정
- 기타 계정 멤버계정이라 부름
- 멤버계정은 한 조직에만
- 모든 계정의 비용을 한번에 관리 지불
- 모든 계정에 대해 집계된 사용량에 대해 관리
- 합쳐서 계산되기에 할인
- 전체 조직에 할인이 되서 좋은
- 자동화 API있음
- OU
- 장점
  - 다수의 VPC를 다루기에 보안 더 뛰어남
  - 모든 로그를 중앙 계정으로 하면 더 편함
  - 모든 멤버 계정을 관리 할 수 잇음
- 보안 ㅣSCP 적용가능
  - 계정내에 할수있는 걸 제한할 수있음
  - 관리계정엔 적용 안함
  - 구체적인 허용 항목을 작성해줘야함
  - 차단목록과 허용목록이 있음

#### IAM 심화

- iam조건

  - aws:Sourcelp Ip api호출하지 않으면 거부하는 조건

  - aws:RequestRegion 특정리전과 거부 조건

  - ec2:ResourceTag : EC2 인스턴스 태그에 거림

  - aws:MultifactorAuthPresent :  멀티팩터 인증을 강제

- iam for S3
  - s3:ListBucket
    - s3:::test라는 ARN에 적용
    - 버킷 수준의 권한 버킷 특정
    - /* 버킷 내의 모든 객체 권한
- aws:principalOrgID & Resource Based Policies
  - 조직의 멤버 계정에만 리소스 정책이 적용되도록 변경
- IAM Roles vs Resource 기반 정책
  - 교차 계정 
    - 리소스 기반 정책에 추가
      - 권한을 포기할 필요 없음
    - 롤을 사용할 수도 있음
      - 기존의 권한을 모두 포기하고 해당 역할에 할당된 권한을 상속
  - 아마존 이벤트브릿지 사용시
    - 역할 사용
      - 대상에 대한 권한을 요구
    - 리소스 기반 정책
      - 람다, sns,sqs,cloudwatch logs, api gateway
      - 대상 리소스를 수정
    - IAM role
      - kinesis stream, system Manager RUn Command, ECS task
- IAM 권한 경계
  - IAM 개체의 최대 권한을 정의
  - aws organizations scp와 함께 사용가능
- IAM 자격 증명 센터
  - 싱글사인온과 동일
  - 어떤 애플리케이션이라도 연결하여 한번에 로그인
  - 한번 로그인에 모든 서비스 접근
  - ID 공급자
    - IAM 저장소나
    - 서드파티 ID공급자에 연결
  - 다중 계정 권한
    - 여러 계정에 대한 액세스 관리
  - 애플리케이션 
    - 어떤 사용자 또는 그룹이 어떤 애플리케이션에 액세스 할 수 있는지 정의
    - url
  - 속성 기반 액세스 제어 (ABAC)
    - 사용자 속성 기반으로 권한

#### Directory Service

- Microsoft AD
  - AD 도메인 서비스를 사용하는 서버에 사용되는 소프트웨어
  - ad의 모두 관리 대상
  - 중앙 집권식 관리
  - 모든 객체는 트리로 구성되며 트리의 그룹 포리스트
- AWS Directory Services
  - 관리형 Microsoft AD
    - 자체 액티브 디렉터리 생성, 로컬에서 관리 MFA 지원
    - 온프레스와 신뢰 가능
  - AD 커넥터
    - 프록시로 온프레미스 AD에 리다이렉트, MFA 지원
    - 온프레미스 AD에서만 관리
  - Simple AD
    - AD 호환 관리형 디렉터리
    - Microsoft 디렉터리 사용 x 온프레미스 ad와도 결합 x
  - IAM Identity Center와 액티브 디렉터리 통합
    - 관리형 ad 일경우
      - IAM Identity Center를 연결
    - 자체 관리형 디렉터리
      - 관리형 ad연결
      - ad 커넥터 연결

#### aws control tower

- 다중 걔정 aws 관리를 쉽게 
- 자동으로 생성
- 장점
  - 클릭 몇번으로 환경 설정
  - 가드레일로 정책관리 지속적 가능
  - 자동으로 교정 관ㄹ리
  - 대화형 대시보드
- 가드레일
  - 모든 계쩡에 대해 가버는스 받을 수잇음
  - 예방 가드레일
    - 무언가로부터 계정을 보호
    - SCP를 사용해 적용
  - 탐지 가드레일
    - AWS Config 사용

### 3. AWS 보안 및 암호화

- 암호화 101
- 전송중 암호화
  - TLS SSL
    - 데이터가 전송되기 전에 암호화 받은 후에 해독
    - TLS  인증서 활용 
    - 중간자 공격을 당하지 않기 위해
- 서버사이드 암호화
  - 암호화 과정이 서버가 받은후에 일어나서 안전하게 저장
  - 고객에게 되돌리기전에 복호화
- 클라이언트 측 암호화
  - 데이터가 클라이언트 측에서 암호화와 해독
  - 서버는 데이터를 해독할수없어야함
  - 봉투 암호화

#### KMS

- 키관리 서비스
- IAM과 완벽히 통합
- CloudTrail을 통해 여러분의 키를 사용하기 위해 이루어진 모든 api 호출을 감시할수있는게 장점
- 모든 서비스에 
- 비밀 데이터 있다면 절대로 평문 텍스트에 저장 x
- 종류
  - 대칭 KMS 키
    - 데이터를 암호화하고 복호화 하는 데 사용되는 암호화 키가 하나만 존재
    - KMS 가 통합된 모든 AWS 서비스는 대칭 키를 사용
    - 키 자체에는 절대로 액세스 할수 없음
  - 비대칭 키
    - 하나는 암호화(퍼블릭)하는 하나는 복호화(브라이빗)하는
    - 퍼블릭키는 접근가능 프라이빗 접근 불가
- 키 타입
  - AWS가 소유한 키 : 무료 SSE-S3 기본값
  - AWS 관리형 키 : 무료 
  - 고객 관리형 키 : 한달에 1달러
  - KMS 가격이 책정 호출10000당 0.03불
- 자동 키 순환
  - 자동으로 1년마다
  - 고객생 관리형 1년 또는 수작업
- KMS 키 정책
  - S3 버킷 정책과 비슷
  - 키 정책이 없다면 아무도접근 불가
  - 기본정책
    - 모든 사람이 이 키에 액세스
  - 커스텀 KMS 키 정책
    - 사용자의 역할 지정
    - 교차 계정 액세스 할때 유용

- 다중 리전 키
  - 다른 aws 리전에서 사용할 수있는 키
  - 한 리전에서 암호화한다음 다른리전에서 복호화 가능
  - 동일한 키 id와 동일한 키 구성요소가짐
  - 한 리전에서 암호화 다른리전에서 복호화
  - 데이터를 재암호화 할필요 없음
  - KMS 다중 리전 키는 전역으로 사용할 수 없음
  - 기본키가 있고 복제 키가 있는것
  - 각 다중 리전 키는 자체 키 정책 등으로 각각 독립적으로 관리
  - 특정 사용사례 제외, 권장 X
  - 전역 클라이언트 암호화
  - DynamoDB 전역 테이블과 KMS 다중 리전 키 클라이언트측 암호화
    - 전체 테이블 암호화 X 
    - 테이블의 속성 암호화  특정 클라이언트만 사용
  - 글로벌 오로라
    - AWS Encryption SDK 사용

#### S3 복제와 암호화된 객체

- 복제하면 기본으로 암호화되지 않은 객체와 SSE-S3로 암호화된 객체가 기본으로 복제
- 고객 제공 키인 SSE-C로 암호화된 객체도 복제될 수 잇음
- SSE-KMS로 암호화도 있음
  - 옵션을 활성화 해야함
  - 대상내 객체를 뭘 하는지 해야함

#### 암호화된 AMI 공유 프로세스

- AMI 는 KMS로 암호화
- AMI 속성 수정
- 일반적으로 키정책으로 실행
- IAM롤이나 AIM 사용자생성

#### SSM 파라미터 스토어

- 구성 및 암호를 위한 보안 스토리지
- 암호화할지 설정 KMS서비스 사용 가능
- SDK도 이용가능
- 구성과암호 버전
- IAM 보안
- EVentBridge에서도 사용가능
- 매개 변수 저장가능

#### AWS Secrets Manager

- 암호를 저장하는 최신 서비스
- x일마다 강제로 암호를 교체하는 기능 있어 암호 관리 더 효율적
- 교체할 암호를 강제 생성도 가능
- 다양한 서비스와도 통합 잘됨
- 암호는 kms서비스 
- RDS와 Aurora의 통합 혹은 암호에 대한 내용 AWS Secrets Manager
- 다중 리전 암호
  - 복수 aws 리전에 복제가능

#### AWS Certificate Manager(ACM)

- TLS 인증서를 AWS에서 프로비저닝, 관리 및 배포하게 해줌
- 퍼블릭과 프라이빗 TLS 인증서를 모두 지원
- 퍼블릭 TLS인증서 사용 시에는 무료로 이용 가능
- 자동으로 갱신하는 기능
- AWS 서비스와 통합
  - ELB
  - CloudFront
  - API
- ㅇEC2와는 불가 
- 과정
  - 인증서에 포함할 도메인네임 작성
  - 유효성 검증 방법 선택
    - dns 검증
    - 이메일 검증
    - dns 검증만 CNAME record
  - 인증서 발행
  - 자동 갱신 목록에 추가
    - 60일 전에 자동으로 갱신 acm이
- acm 외부에서 생성된 인증서 acm 가져오는 옵션 존재
  - 외부에서 생성이기에 자동갠신 x
  - 만료되기전에 직접 가져와야함
  - acm 만료 45일 전부터 eventBridge로 나이벤트 나타냄
  - aws config도 가능
- acm과 api gateway와 통합
  - 엔트포인트 타입
    - 엣지 최적화 유형
      - 글로벌 클라이언트를 위함
      - 디폴트
      - 하나의 리전에만 있는 api gatewqy로 보냄
    - 리전 엔드 포인트 유형
      - 클라이언트와 같은 ㄱ리전에 있을때
    - 프라이빗
      - VPC 내부에만 연결 가능
  - API Gateway에 사용자 지정 도메인 이름 지정

#### 웹 애플리케이션 방화벽

- 계층 7에서 일어나는 일반적인 웹 취약점 공격으로부터 보호
- http 
- 방화벽 배포
  - 애플리케이션 로드 밸런서
  - api gateway 
  - cloudFront
  - AppSync GraphQL API
  - Cognito User Pool
- 웹 액세스 제어 목록(ACL)과 규칙 정의
  - 규칙 IP주소 기반
  - IP 세트 지정
  - 또한 HTTP 헤더나 바디에도 XSS등 할수있음
  - 용량에 제약 걸수있음
- ACL 리전에만 적용

#### 실드 DDS보호

- 디도스에 대한 보호
  - 디도스 : 분산 서비스 거부 공격 
    - 인프라에 동시에 엄청난 양의 요청이세계곳곳에 컴퓨터에서 요청
    - 목적 : 인프라에 과부화, 실제 사용자들에게 서비스 제공 불가
- AWS Shield Standard
  - aws고객에게 무료
- AWS Shield Advanced
  - 선택적으로 제공되는 디도스 완화 서비스
  - 조직당 월 3000달러
  - 정교하게 디도스 공격을 막아줌
  - 디도스 대응 팀이 항시 대기
- Firewall Manager
  - 방화벽 규칙을 관리하는 서비스
  - 여러 계정의 규칙을 동시에 관리 가능
  - 보안 규칙의 집합인 보안정책 설정
    - WAF rules
    - AWS Shield Advanced
  - 조직에서 애플리 케이션 로드밸런서에대해 waf 규칙을 생성후  새 alb 생성시 방화벽 매니저에서 자동으로 새 alb에도 적용
  - 

