# 24/7/15 AWS SAA(Solutions Architect Associate) - Day05

## Route53,솔루션 아키텍쳐,Amazon S3


### 1. Route53

#### TTL

- Time To Live 
  - 캐싱이 되는 시간 설정

#### CNAME VS Alias

- CNAME
  - 호스트 이름이 다른 호스트 이름으로 향하도록 가능
  - 루트 도메인이름이 아닌 경우에만 가능
- Alias
  - 호스트 이름이 특정 AWS 리소스로 향하도록 가능
  - 루트 및 비 루트 도메인 모두에 작동
  - DNS의 확장기능
  - ALB에서 IP가 바뀌면 바로 인식
  - CNAME과 달리 별칭 레코드는 Zone Apex DNS 네임스페이스의 상위 노드로 사용 가능
  - 별칭 레코드의 타입은 항상 A또는 AAAA
  - 별칭레코드를 쓰면 TTL사용 불가
  - 대상
    - Elastic Load Balancers
    - CloudFron Distributions
    - API Gateway
    - Elastic Beantalk environments
    - S3 Websites
    - VPC Interface Endpoints
    - Global Accelerator accelerator
    - Route 53 record in same host zone
  - EC2의 DNS 이름에 대해서는 별칭레코드 설정 불가

- 라우팅 정책
  - Route 53이 DNS쿼리에 응답하는것을 도움
  - DNS관점, DNS는 트래픽을 라우팅 X
  - DNS는 DNS쿼리에만 응답 
  - 정책
    - 단순
      - 일반적으로 트래픽을 단일 리소스로 전송
      - 동일한 레코드에 여러개의 값을 지정하는 것도 가능
      - 다중 값 경우 클라이언트 쪽에서 무작위로 하나 고름
      - 별칭 레코드를 함께 사용시 하나의 AWS리소스만을 대상으로 지정 가능
      - 상태확인 못함
    - ㄱㅏ중치 기반
      - 가중치를 활용해 요청의 일부 비율을 특정 리소스로 전송
      - 각 레코드에 상대적ㅇ로 가중치를 할당 가능
      - 각 레코드로 보내지는 트래픽 양(%)은 해당 레코드의 가중치를 전체 가중치로 나눈 값
      - DNS 레코드들은 동일한 이름과 유형을 가져야 함
      - 상태확인 가능
      - 가중치를 0으로놔 트래픽 보내기를 중단 가중치를 바꿀수도 있음
    - 지연 시간 기반
      - 지연시간이 가장 짧은, 즉 가장 가까운 리소스로 리다이렉팅
      - 지연 시간에 민감한 웹사이트나 애플리케이션에 사용
      - 가장 가까운 식별된 AWS 리전에 연결하기까지 걸리는 시간을 기반으로 측정
      - 상태확인과 연결 가능
    - 장애조치
      - 보조 인스턴스가 대체
    -  지리적
      - 사용자의 실제 위치를 기반
      - 가장 정확한 위치로 그ip로 라우팅
      - 일치하는 위치가 없는 경우 기본 레코드 생성
      - 사용 사례 : 콘텐츠 분산을 제한, 로드 밸런싱 등을 실행하는 웹사이트 현지화
      - 상태확인과 연결 가능
    - 다중 값 응답
      - 트래픽을 다중 리소스로 라우팅할 때 사용
      - 다중 값과 리소스를 반환
      - 상태 확인과 연결
      - 각각 다중 값 쿼리에 최대 8개의 정상 레코드가 반환
      - ELB와 유사, BUT ELB 대체 X
    - 지리 근접 라우팅 정책
      - 편향값을 사용해 특정 위치를 기반으로 리소스를 더 많은 트래픽을 이동
      - 지리적 위치를 변경하려면 편형값을 지정
      - 많은 리소스를 보낼거면 편향값을 증가시켜 확장
      - 리소스에 트래픽을 줄이려면 편향값을 음수로 축소
    - IP 기반 라우팅
      - CIDR목록 정의, 클라이언트의  IP 범위
      - 사용사례 : 성능 최적화, 네트워크 비용 절감
      - 

- 상태확인

  - 주로 공용 리소스에대한 상태를 확인
  - 상태 확인 => DNS 장애 조치 자동화
    - 공용 엔드 포인트를 모니터링 (애플리케이션, 서버, 다른 aws 자원)
      - 전세계에서 온 15개의 상태확인이 엔드포인트의 상태를 확인하고 임계값을 정상 혹은 비정상으로 설정
      - 간격 설정 가능
        - 30초 마다 정기적 확인
        - 10초마다 (비용 올라감) 빠른상태확인
      - HTTP,HTTPS, TCP 등 프로토콜을 지원
      - 18% 이상의 상태확인이 엔드포인트를 정상이라고 판단하면 Route 53도 이를 정상이라고 간주
      - 상태확인을 할 위치도 선택 가능
      - 상태확인은 로드 밸런서로부터 다른 상태확인을 모니터링하는 상태확인 2xx나 3xx 코드를 받아야만 통과
      - 상태 확인의 작동이 가능하려면 애플리케이션 밸런서나 엔드포인트에 접근이 가능해야함  
    - 계산된 상태 확인
      - 여러 개의 상태 확인 결과를 하나로 합쳐줌
      - 합치기 위한  조건 (OR,AND,NOT)
      - 하위 상태 확인을 256개까지 모니터링 가능
      - 상위 상태 확인이 통과하기 위해 몇 개의 상태 확인을 통과해야 하는지도 지정가능
    - CloudWatch 경보의 상태를 모니터링하는 상태확인

  - 각 매트릭을 CloudWatch의 지표에서 확인 가능

  - 개인 리소스의 상태확인
    - VPC의 외부에 존재
    - 개인 엔드 포인트에 접근이 불가
    - CloudWatch 지표를 만들어 CloudWatch 알람을 할당하는 식으로 이 문제를 해결

- 도메인 이름 레지스트라 VS DNS 서비스

  - 도메인 이름 레지스트라를 통해 원하는 도메인 이름을 구매 가능
    - 매년 지불
  - 레지스트라를 통해 도메인 등록시 DNS 서비스 제공
  - 도메인을 타사 등록 대행사에서 구매해도 DNS 서비스 제공자로 Route 53을 사용 가능
    - 공용 호스팅 영역 생성
    - Domain Registrar != DNS Service

### 2. 솔루션 아키텍쳐

- 시계 웹사이트
  - 공용 IP와 사설 IP EC2 인스턴스
  - 탄련적 IP VS ROUTE53 VS 로드밸런서
  - 오토 스케일링
  - 다중 AZ
  - 상태확인
  - 보안 그룹규칙
  - 용량
- MyClothes.com
  - ELB 고정세션
  - 쿠키 저장을 위한 웹클라이언트
  - ElastiCacne
    - DynamoDB
    - 읽기 전용 복제본
    - 다중 AZ
  - RDS
    - 다중 AZ
  - 보안그룹 설정

- 애플리케이션 빠르게 인스턴스화
  - EC2
    - Golden AMI 사용
    - 사용자 데이터 부트스트랩화
  - RDS
    - 스냅샷
  - EBS Volumes
    - 스냅샷

#### BEANSTALK

- 개발자 입장에서 애플리케이션을 AWS에 배포
- 스케일링, 애플리케이션 상태 모니터링, 인스턴스 설정 등 함
- 코드 자체로만 관리
- 모든 컴포넌트의 설정에 대한 완벽한 통제력을 가짐

- 컴포넌트
  - 환경,버전, 설정 등 Beanstalk 컴포넌트인 애플리케이션
  - 애플리케이션 버전
- 배포모드
  - 싱글인스턴스 : 개발용, 하나의 EC2 인스턴스 가짐 그게 탄력적 IP사용, 로드밸런서 없음
  - 고가용성 : 프로덕션 환경에 적합 , 로드 밸런서 있음

### 3. Amazon S3

#### Amazon S3

- 무한하게 확장할 수 있는 스토리지
- 사용사례
  - 백업과 스토리지로 활용
  - 재해 복구 용도
  - 아카이브용
  - 하이브리드 클라우드 스토리지
  - 애플리케이션 호스팅
  - 미디어 호스팅
  - 데이터 레이크를 보유 빅데이터 분석
  - 정적 사이트를 호스팅
- 버킷
  - 파일을 버킷에 저장
  - 버킷은 상위 레벨 디렉토리로 표시
  - 파일은 객체라고함
  - 계정안에 생성, 버킷에는 전역적으로 고유한 이름이 있어야함
  - 리전수준에서 정의
  - S3버킷 명명 규칙
    - 대문자나 밑줄 X
    - 3~36자
    - IP이면 X
    - 소문자나 숫자로 시작
    - 몇몇 접두사 안됨
- 객체
  - 키
    - 객체나 파일에는 키라는것이 존재
    - 키는 전체 경로를 나타냄
    - 키는 접두사와 객체이름으로 구성
    - S3 그 자체로는 디렉토리의 개념 X
    - 키는 길고 슬래시를 포함하며, 접두사와 객체이름으로 만들어짐
  - 객체
    - 파일 등 원하는 것은 뭐든지 S3 업로드 가능
      - 5TB 최대
      - 5GB 초과 업로드시, 멀티파트 업로드 사용
      - 메타데이터도 존재, 객체의 키 값 쌍으로

#### S3 Security

- 사용자 기반
  - IAM 정책
- 리소스 기반
  - S3 버킷 정책
  - 객체 ACL (객체 액세스 제어 목록)
  - 버킷수준 ACL

- 암호 키 사용

- 버킷 정책
  - JSON기반의 정책
    - 리소스블록 : 버킷과 객체를 정책에 알려줌
    - 허용 또는 거부
    - 액션 : 허용하거나 거부할 수 있는 API

#### S3 - 정적 웹사이트 생성

- S3는 웹 사이트를 호스팅하고 인터네셍서 액세스 가능
- 웹 사이트 URL은 이것을 생성하는 AWS 리전에 따라 달라짐
  - Dash와 comma 이름 다름

#### 버전관리

- 파일을 버전관리할 수 있다 (버킷 수준에서 활성화)
- 동일한 키를 업로드하고 해당 파일을 덮어쓰는경우 버전 2, 버전 3 등을 생성
  - 이전버전으로 쉽게 롤백 가능
- 버전관리를 활성화하기 전에 버전관리가 적용되지 않은 모든 파일은 널 버전을 가짐
- 버전 관리를 중단해도 이전 버전은 삭제 x

#### 복제

- CRR - 교차 리전 복제
- SRR - 같은 리전으로 복제
- 복제는 비동기로
- 다른 계정으로 옮기는것도 가능
- 복제 기능이 정상적으로 실행되려면 S3에 올바른 IAM  권한 필요
- 사용 사례
  - CRR : 컴플라이언스, 즉 법규나 내부 체제관리, 데이터가 다른 리전에 있어 발생할 수 있는 지역 시간 감소
  - SRR : 다수의 S3 버킷간의 로그를 통합 할때나 개발환경이 별도로 있어 운영환경과 개발환경간의 실시간 복제를 필요할때
- 복제를 활성화한 후 새로운 객체만 복제 대상이 됨
- 기존의 객체를 복제하려면 S3배치 복제 기능 사용
- 삭제하려면 소스 버킷에서 대상버킷으로 삭제 마커를 복제
- 버전 ID로 삭제하는경우 버전 ID는 복제 X
- 체이닝 복제는 불가

#### S3 스토리지 클래스

- Amazon S3 Standard - 범용적

  - 가용성 99.99%
  - 자주 액세스하는 데이터
  - 지연시간짧고 처리량 높음
  - 두개의 기능장애를 버틴다
  - 빅데이터
  - 모바일 등등 

- Amazon S3 Infrequent Access(IA)

  - 자주 액세스하지 않지만 빠르게 액세스해야하는 데이터
  - 비용 적어 
  - 검색비용 발생
  - 가용성 99.9%
  - 재해복구와 백업으로 사용

- Amazon S3 One Zone-Infrequent Access

  - 자주 액세스하지 않지만 빠르게 액세스해야하는 데이터
  - 비용 적어 
  - 검색비용 발생
  - 단일 az에서는 높은 내구성을 갖지만 az가 파괴된 경우 데이터 잃음
  - 가용성은 더 낮은 수준인 99.5%
  - 온프레미스 데이터를 백업하거나 재생성 가능한 데이터를 저장하는데 쓰임

- Amazon S3 Glacier

  - 콜드 스토리지, 아카이빙과 백업을 위한 저비용 스토리지
  - 스토리지,검색비용이 들어가
  - Amazon S3 Glacier Instant Retrieval
    - 밀리초 단위로 검색 가능
    - 예를들어 분기에 한번 액세스하는 데이터에 적합
    - 최소 보관기간 90일
  - Amazon S3 Glacier Flexible Retrieval
    - Expedited : 1~5분 이내에 데이터 받음
    - Standard : 3~5시간
    - Bulk: 5 ~ 12 시간

  - Amazon S3 Glacier Deep Archive
    - Standard : 12 시간
    - Bulk : 48시간
    - 비용 가장 저렴
    - 최소 보관 기간도 180일

- Amazon S3 Intelligent Tiering
  - 사용 패턴에 따라 액세스된 티어 간에 객체를 이동할 수 있게 해줌
  - 소액의 월별 모니터링 비용과 티어링 비용이 발생
  - 검색비용 x
  - FrequentAccess 티어난 자동 기본 티어
  - Infrequent Access 티어는 30일 동안 액세스하지 않는 객체 전용 티어
  - Archive Instant Access 티어도 자동이지만 90일 동안 액세스하지 않는 티어 전용
  - Archive Acess 티어는 선택 사항 90일에서 700일까지 구성가능
  - deep Archive Access 티어는 180일에서 700일 이상 액세스하지 않는 객체에 구성할 수 잇습니다.





- S3를 만들때 클래스를 선택할수도 있고, 수동으로 수정도 가능
- 혹은 s3 수명주기 구성을 사용해 스토리지 클래스간에 옮길수도 있다.

- 내구성과 가용성
  - 내구성 : 객체가 손실되는 횟수를 나타냄
    - 99.9999999999%의 내구성을 보장
    - 천만개의 객체를 저장했을때 평균적으로 10000년에 한번 객체 손실이 예상
    - 모든 스토리지 클래스의 내구성은 같다
  - 가용성 : 서비스가 얼마나 용이하게 제공되는지 나타냄
    - 스토리지 클래스마다 다름

- 스토리 클래스 간에 객체를 옮기는 방법
  - 자주 액세스 하지 않는다면 점점 내려보냄
  - 만일 객체를 아카이브화 하려는 걸 알고 있다면 Glacier 티어나 Deep Archive 티어로 이전
  - 라이프 사이클 규칙을 이용해서 자동으로 옮길수도 있다

#### 라이브사이클 룰

- Transition Actions : 다른 스토리지 클래스로 이전하기 위해 객체를 설정
  - 예_생긴지 60일 후 Standard IA Class에 이전
- Expiration action : 일정한 시간 뒤에 만료되어서 객체를 삭제하도록 설정
  - ex_ 365일 후에 삭제
- Amazon S3 Analytics
  - Standard나 Standard IA에 관한 추천사항을 제시
  - One-zone IA나 Glacier와는 호환 x
  - 보고서 매일 업데이트
  - 데이터 분석 결과가 나오는게 보일때 까지는 24시간 내지 48시간 소요
